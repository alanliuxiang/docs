= 安装
:toc: manual

== 安装

[source, text]
.*Master 上执行 ansible 脚本*
----
# ansible-playbook -i hosts-3.10.14 /usr/share/ansible/openshift-ansible/playbooks/deploy_cluster.yml
----

== 安装成功验证

[source, text]
.*1 - 查看 INSTALLER STATUS（ansible 脚本运行的结尾）*
----
INSTALLER STATUS *****************************************************************************************************************************************************************************
Initialization              : Complete (0:00:27)
Health Check                : Complete (0:00:03)
Node Bootstrap Preparation  : Complete (0:11:25)
etcd Install                : Complete (0:00:42)
NFS Install                 : Complete (0:00:09)
Master Install              : Complete (0:03:43)
Master Additional Install   : Complete (0:01:02)
Node Join                   : Complete (0:03:48)
Hosted Install              : Complete (0:00:58)
Web Console Install         : Complete (0:00:41)
Metrics Install             : Complete (0:02:03)
Prometheus Install          : Complete (0:01:10)
Service Catalog Install     : Complete (0:07:20)
----

[source, text]
.*2 - 查看所有 Nodes*
----
# oc get nodes
NAME                 STATUS    ROLES     AGE       VERSION
infra.example.com    Ready     infra     1h        v1.10.0+b81c8f8
master.example.com   Ready     master    1h        v1.10.0+b81c8f8
node1.example.com    Ready     compute   1h        v1.10.0+b81c8f8
----

[source, text]
.*3 - 查看所有 Pods*
----
# oc get pods --all-namespaces -o wide | grep master.example.com
default                             registry-console-1-bgcqm                1/1       Running     0          1h        10.244.0.3        master.example.com
kube-service-catalog                apiserver-t4f2m                         1/1       Running     0          1h        10.244.0.7        master.example.com
kube-service-catalog                controller-manager-bswhl                1/1       Running     0          1h        10.244.0.8        master.example.com
kube-system                         master-api-master.example.com           1/1       Running     0          1h        192.168.122.101   master.example.com
kube-system                         master-controllers-master.example.com   1/1       Running     0          1h        192.168.122.101   master.example.com
kube-system                         master-etcd-master.example.com          1/1       Running     0          1h        192.168.122.101   master.example.com
openshift-infra                     hawkular-metrics-hszwd                  1/1       Running     0          1h        10.244.0.6        master.example.com
openshift-metrics                   prometheus-node-exporter-wxzjr          1/1       Running     0          1h        192.168.122.101   master.example.com
openshift-node                      sync-4mll5                              1/1       Running     0          1h        192.168.122.101   master.example.com
openshift-sdn                       ovs-cdq28                               1/1       Running     0          1h        192.168.122.101   master.example.com
openshift-sdn                       sdn-sssfl                               1/1       Running     0          1h        192.168.122.101   master.example.com
openshift-template-service-broker   apiserver-qkqvc                         1/1       Running     0          1h        10.244.0.9        master.example.com
openshift-web-console               webconsole-7c484b9ff8-76rh5             1/1       Running     1          1h        10.244.0.4        master.example.com

# oc get pods --all-namespaces -o wide | grep node1.example.com
openshift-infra                     heapster-6wxj2                          1/1       Running     0          1h        10.244.4.3        node1.example.com
openshift-metrics                   prometheus-node-exporter-lmsxz          1/1       Running     0          1h        192.168.122.105   node1.example.com
openshift-node                      sync-xzxxv                              1/1       Running     0          1h        192.168.122.105   node1.example.com
openshift-sdn                       ovs-grrvm                               1/1       Running     0          1h        192.168.122.105   node1.example.com
openshift-sdn                       sdn-fbm27                               1/1       Running     0          1h        192.168.122.105   node1.example.com

# oc get pods --all-namespaces -o wide | grep infra.example.com
default                             docker-registry-1-77krn                 1/1       Running     0          1h        10.244.2.4        infra.example.com
default                             router-1-x9q6x                          1/1       Running     0          1h        192.168.122.102   infra.example.com
openshift-ansible-service-broker    asb-1-wbbhr                             1/1       Running     0          1h        10.244.2.8        infra.example.com
openshift-infra                     hawkular-cassandra-1-ggwxr              1/1       Running     0          1h        10.244.2.6        infra.example.com
openshift-infra                     hawkular-metrics-schema-5699f           0/1       Completed   0          1h        10.244.2.5        infra.example.com
openshift-metrics                   prometheus-node-exporter-j7lr5          1/1       Running     0          1h        192.168.122.102   infra.example.com
openshift-node                      sync-qs9x2                              1/1       Running     0          1h        192.168.122.102   infra.example.com
openshift-sdn                       ovs-ghqhn                               1/1       Running     0          1h        192.168.122.102   infra.example.com
openshift-sdn                       sdn-fnl8v                               1/1       Running     0          1h        192.168.122.102   infra.example.com
----

[source, text]
.*4 - 查看不同类型节点的镜像*
----
# for i in master infra node1 ; do ssh $i.example.com 'docker images ; echo' ; done
REPOSITORY                                                    TAG                 IMAGE ID            CREATED             SIZE
registry.example.com/openshift3/ose-node                      v3.10.14            da5c8c13b7e8        11 days ago         1.27 GB
registry.example.com/openshift3/registry-console              v3.10.14            8d51f41d6fa3        13 days ago         231 MB
registry.example.com/openshift3/ose-deployer                  v3.10.14            414fcb4f3482        13 days ago         789 MB
registry.example.com/openshift3/ose-web-console               v3.10.14            e3d8bd0ed7d1        13 days ago         318 MB
registry.example.com/openshift3/ose-control-plane             v3.10.14            64b4a2f9caae        13 days ago         789 MB
registry.example.com/openshift3/ose-service-catalog           v3.10.14            96ce9ced41cd        13 days ago         312 MB
registry.example.com/openshift3/prometheus-node-exporter      v3.10.14            0a9d568fce09        13 days ago         223 MB
registry.example.com/openshift3/metrics-hawkular-metrics      v3.10.14            ac44e9cebacf        13 days ago         1.71 GB
registry.example.com/openshift3/ose-template-service-broker   v3.10.14            669fe6121623        13 days ago         283 MB
registry.example.com/openshift3/ose-pod                       v3.10.14            ddeb851f17ad        13 days ago         214 MB
registry.example.com/rhel7/etcd                               3.2.22              98217b7c8905        2 weeks ago         256 MB

REPOSITORY                                                   TAG                 IMAGE ID            CREATED             SIZE
registry.example.com/openshift3/ose-node                     v3.10.14            da5c8c13b7e8        11 days ago         1.27 GB
registry.example.com/openshift3/ose-haproxy-router           v3.10.14            b0bd92d8865b        13 days ago         808 MB
registry.example.com/openshift3/ose-deployer                 v3.10.14            414fcb4f3482        13 days ago         789 MB
registry.example.com/openshift3/ose-docker-registry          v3.10.14            a21f6776105b        13 days ago         283 MB
registry.example.com/openshift3/prometheus-node-exporter     v3.10.14            0a9d568fce09        13 days ago         223 MB
registry.example.com/openshift3/metrics-cassandra            v3.10.14            ac838937235a        13 days ago         555 MB
registry.example.com/openshift3/metrics-schema-installer     v3.10.14            c973002f575e        13 days ago         841 MB
registry.example.com/openshift3/ose-ansible-service-broker   v3.10.14            b6b9a4fb59c0        13 days ago         440 MB
registry.example.com/openshift3/ose-pod                      v3.10.14            ddeb851f17ad        13 days ago         214 MB

REPOSITORY                                                 TAG                 IMAGE ID            CREATED             SIZE
registry.example.com/openshift3/ose-node                   v3.10.14            da5c8c13b7e8        11 days ago         1.27 GB
registry.example.com/openshift3/prometheus-node-exporter   v3.10.14            0a9d568fce09        13 days ago         223 MB
registry.example.com/openshift3/metrics-heapster           v3.10.14            b43f9c9ba0c9        13 days ago         281 MB
registry.example.com/openshift3/ose-pod                    v3.10.14            ddeb851f17ad        13 days ago         214 MB
----

[source, text]
.*5 - 查看 Master 监听端口*
----
# netstat -antulop | grep LISTEN
tcp        0      0 0.0.0.0:8443            0.0.0.0:*               LISTEN      12700/openshift      off (0.00/0/0)
tcp        0      0 0.0.0.0:8444            0.0.0.0:*               LISTEN      12650/openshift      off (0.00/0/0)
tcp        0      0 192.168.122.101:2379    0.0.0.0:*               LISTEN      12680/etcd           off (0.00/0/0)
tcp        0      0 192.168.122.101:2380    0.0.0.0:*               LISTEN      12680/etcd           off (0.00/0/0)
tcp        0      0 0.0.0.0:111             0.0.0.0:*               LISTEN      26356/rpcbind        off (0.00/0/0)
tcp        0      0 127.0.0.1:53            0.0.0.0:*               LISTEN      20501/openshift      off (0.00/0/0)
tcp        0      0 10.244.0.1:53           0.0.0.0:*               LISTEN      21745/dnsmasq        off (0.00/0/0)
tcp        0      0 0.0.0.0:8053            0.0.0.0:*               LISTEN      12700/openshift      off (0.00/0/0)
tcp        0      0 192.168.122.101:53      0.0.0.0:*               LISTEN      21745/dnsmasq        off (0.00/0/0)
tcp        0      0 172.17.0.1:53           0.0.0.0:*               LISTEN      21745/dnsmasq        off (0.00/0/0)
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      992/sshd             off (0.00/0/0)
tcp        0      0 127.0.0.1:11256         0.0.0.0:*               LISTEN      20501/openshift      off (0.00/0/0)
tcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN      1382/master          off (0.00/0/0)
tcp6       0      0 :::9090                 :::*                    LISTEN      1/systemd            off (0.00/0/0)
tcp6       0      0 :::10250                :::*                    LISTEN      24344/hyperkube      off (0.00/0/0)
tcp6       0      0 :::9100                 :::*                    LISTEN      21015/node_exporter  off (0.00/0/0)
tcp6       0      0 :::111                  :::*                    LISTEN      26356/rpcbind        off (0.00/0/0)
tcp6       0      0 :::10256                :::*                    LISTEN      20501/openshift      off (0.00/0/0)
tcp6       0      0 fe80::e4ec:eeff:feec:53 :::*                    LISTEN      21745/dnsmasq        off (0.00/0/0)
tcp6       0      0 fe80::bca3:6ff:fe69::53 :::*                    LISTEN      21745/dnsmasq        off (0.00/0/0)
tcp6       0      0 fe80::7cae:5cff:fe6d:53 :::*                    LISTEN      21745/dnsmasq        off (0.00/0/0)
tcp6       0      0 fe80::d0d2:cdff:fe20:53 :::*                    LISTEN      21745/dnsmasq        off (0.00/0/0)
tcp6       0      0 fe80::a018:1bff:fe00:53 :::*                    LISTEN      21745/dnsmasq        off (0.00/0/0)
tcp6       0      0 fe80::b8bd:20ff:feb6:53 :::*                    LISTEN      21745/dnsmasq        off (0.00/0/0)
tcp6       0      0 fe80::746a:65ff:fe41:53 :::*                    LISTEN      21745/dnsmasq        off (0.00/0/0)
tcp6       0      0 fe80::88e8:5ff:fecb::53 :::*                    LISTEN      21745/dnsmasq        off (0.00/0/0)
tcp6       0      0 fe80::5054:ff:fe4c:2:53 :::*                    LISTEN      21745/dnsmasq        off (0.00/0/0)
tcp6       0      0 :::22                   :::*                    LISTEN      992/sshd             off (0.00/0/0)
tcp6       0      0 ::1:25                  :::*                    LISTEN      1382/master          off (0.00/0/0)
----


