
= 后续配置
:toc: manual
:toc-placement: preamble

本部分包括安装完成后续的配置。本部分操作在 Master 结点上执行。


== 配置用户及子域名

[source, bash]
.*安装Httpd-tools，并创建用户及密码*
----
yum -y install httpd-tools
htpasswd -cb /etc/origin/master/htpasswd redhat welcome1
htpasswd -b /etc/origin/master/htpasswd admin admin
oadm policy add-cluster-role-to-user admin admin
----

[source, bash]
.*修改配置文件/etc/origin/master/master-config.yaml内的用户验证配置*
----
cp /etc/origin/master/master-config.yaml /etc/origin/master/master-config.yaml.bak.$(date "+%Y%m%d%H%M%S");
sed -i 's/.*subdomain.*/  subdomain: apps.example.com/' /etc/origin/master/master-config.yaml ;
----

NOTE: 本部分在实验环境可以忽略

[source, bash]
.*重启OpenShift，使配置修改生效*
----
systemctl restart atomic-openshift-master-api atomic-openshift-master-controllers
systemctl restart atomic-openshift-node
----

== Gitlab 安装与配置

[source, text]
.*安装*
----
# rpm -ivh gitlab-ee-10.4.0-ee.0.el7.x86_64.rpm
----

[source, bash]
.*修改/etc/gitlab/gitlab.rb将external_url设置成如下*
----
external_url 'http://gitlab.example.com'
----

NOTE: 记得修改所有客户端的/etc/hosts表，加入 gitlab.example.com 的地址。

[source, text]
.*执行如下命令完成 gitlab 配置及启动 gitlab*
----
# gitlab-ctl reconfigure
# gitlab-ctl start
----

NOTE: 启动完成后通过浏览器访问 http://gitlab.example.com，第一次访问的时候会提示创建密码，密码必须是6位登录名是root。
