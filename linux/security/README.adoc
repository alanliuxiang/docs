= 安全
:toc: manual

== 目录服务

=== 什么是 LDAP

LDAP(Lightweight Directory Access Protocol) is used to access information in directory services like over a network.

|===
|Field |描述

|dn(distinguished name)
|This refers to the name that uniquely identifies an entry in the directory.

|dc(domain component)
|This refers to each component of the domain. For example www.google.com would be written as DC=www,DC=google,DC=com

|ou(organizational unit)
|This refers to the organizational unit (or sometimes the user group) that the user is part of. If the user is part of more than one group, you may specify as such, e.g., OU= Lawyer,OU= Judge.

|cn(common name)
|This refers to the individual object (person's name; meeting room; recipe name; job title; etc.) for whom/which you are querying.

|===

https://en.wikipedia.org/wiki/LDAP_Data_Interchange_Format

== Transport Layer Security (TLS)

Transport Layer Security (TLS) 是用于加密网络通信的方法。TLS 是 Secure Sockets Layer(SSL) 的后续版本。

TLS 同时即允许客户端验证服务器的身份，也允许服务器验证客户端的身份（后者为可选）。

TLS 基于证书的概念。一个证书包含多个部分：公钥（public key）、服务器身份（server identity）和证书颁发机构的签名（certificate authority）。对应的私钥绝对不会公开。使用私钥加密的任何数据只能通过公钥解密，反之亦然。

在初始握手期间，当设置加密连接时，客户端和服务器同意一组由服务器和客户端均支持的加密密码，然后它们交换随机数据的位。客户端使用此随机数据生成会话密钥，这是一个将用于更快速的对称加密的密钥，其中相同密钥同时用于加密和解密。为确保此密钥不被泄露，它被发送到使用服务器的公钥（属于服务器证书）加密的服务器。

下图显示了 TLS 握手一个（简化）版本：

image:img/TLS_handshake.png[]

1. 客户端通过 ClientHello 消息启动与服务器的连接。作为此消息的一部分，客户端发送 32 字节的随机数字，包括时间戳记以及客户端支持的加密协议和密码的列表。
2. 服务器以 ServerHello 消息响应，包含另一个 32 字节随机数字，其中带有时间戳记以及客户端应使用的加密协议和密码。(服务器也会发送服务器证书，其中由公钥、常规服务器身份信息（如 FQDN）以及来自可信认证颁发机构 (CA) 的签名。此证书还可以包含已对证书签名的所有证书颁发机构（直至根 CA）的公共证书。)
3. 客户端通过检查提供的身份信息是否匹配，以及验证所有签名，检查这些签名是否是由客户端信任的 CA 生成，从而验证服务器证书。如果证书确认，则客户端使用先前交换的随机数字来创建会话密钥。客户端随后使用来自服务器证书的公钥加密此会话密钥，然后使用 ClientKeyExchange 消息将其发送到服务器。
4. 服务器解密会话密钥，然后客户端和服务器均开始使用会话密钥来加密和解密通过连接发送的所有数据。
