= 文件系统导视
:toc: manual

== 基本命令

[cols="2a,2"]
|===
|命令 |说明

|`cp file1 file2`
`cp file1 file2 file3 dir`
|拷贝文件

|`mv file1 file2`
`mv file1 file2 file3 dir`
|移动文件

|`rm file1`
`rm -f file1 file2 file3`
|删除文件

|`mkdir dir`
`mkdir -p par1/par2/dir`
|创建文件夹

|`cp -r dir1 dir2`
`cp -r dir1 dir2 dir3 dir4`
|拷贝文件夹

|`mv dir1 dir2`
`mv dir1 dir2 dir3 dir4`
|移动文件夹

|`rm -r dir1`
`rm -rf dir1 dir2 dir3`
|删除文件夹

|`rmdir dir`
|删除空文件夹

|`ln file linkfile`
|创建 hard link

|`ln -s file linkfile`
|创建 soft link
|===

== Linux 文件系统结构

image:img/linux_filesystem_hierarchy.png[]

== 文件的 hard link 和 soft link 

.*Hard Link 和 Soft Link 的区别*
|===
|编号 |描述

|1
|当原始文件删除后 hard link 文件保存了原始文件的内容，而 soft link 不会。

|2
|soft link 可以指向一个文件夹，而 hard link 不可以。
|===

=== ulimit 控制 hard link 和 soft link 最大打开数

`/etc/security/limits.conf` 文件控制 hard link，soft link 以及最大打开文件数。

[source, text]
.*ulimit 查看 soft/hard link*
----
# ulimit
# ulimit -a
----

=== 在文件上创建 link 示例

[source, text]
.*1 - 创建一个文件*
----
# echo "Hello World" > newfile.txt
# ls -l newfile.txt
-rw-r--r--. 1 root root 12 Nov 26 17:18 newfile.txt
----

[source, text]
.*2 - ln 创建一个 hard link*
----
# ln newfile.txt /tmp/newfile-hlink.txt
# ls -l newfile.txt /tmp/newfile-hlink.txt
-rw-r--r--. 2 root root 12 Nov 26 17:18 newfile.txt
-rw-r--r--. 2 root root 12 Nov 26 17:18 /tmp/newfile-hlink.txt
----

[source, text]
.*3 - ln -s 创建一个 soft link*
----
# ln -s newfile.txt /tmp/newfile-slink.txt

# ls -il newfile /tmp/newfile-hlink.txt /tmp/newfile-slink.txt 
  4693201 -rw-r--r--. 2 root root 0 Jul  9 11:39 newfile
  4693201 -rw-r--r--. 2 root root 0 Jul  9 11:39 /tmp/newfile-hlink.txt
134686970 lrwxrwxrwx. 1 root root 7 Jul  9 11:41 /tmp/newfile-slink.txt -> newfile
----

NOTE: 文件和其对应的 hard link 文件的 inode 是相同的。inode 是在磁盘格式化时创建。

[source, text]
.*4 - 编辑文件*
----
# echo "modify from hard link" >> /tmp/newfile-hlink.txt 
# echo "nodify from soft link" >> /tmp/newfile-slink.txt

# cat newfile.txt && cat /tmp/newfile-hlink.txt && cat /tmp/newfile-slink.txt 

# rm newfile.txt
# ls -l /tmp/newfile-hlink.txt /tmp/newfile-slink.txt
-rw-r--r--. 1 root root 34 Jul  9 11:17 /tmp/newfile-hlink.txt
lrwxrwxrwx. 1 root root 11 Jul  9 11:09 /tmp/newfile-slink.txt -> newfile.txt

# cat /tmp/newfile-hlink.txt && cat /tmp/newfile-slink.txt
----

[source, text]
.*5 - ln -s 创建一个 soft link 指向文件夹*
----
# ln -s /tmp /root/tempdir
# ls -l /root/
lrwxrwxrwx.  1 root  root          4 Feb 15 16:38 tempdir -> /tmp
# cd /root/tempdir/
# ls
----

