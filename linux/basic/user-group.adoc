= 用户和组
:toc: manual

== 基本命令

[cols="2a,2"]
|===
|命令 |说明

|`id`
`id USER`
|显示当前登录用户信息，或指定用户信息

|`ps au`
|显示当前 shell 下所有的进程及关联的用户

|`useradd username`
|创建一个用户

|`userdel username`
|删除用户

|`userdel -r username`
|删除用户并且删除相关的 home 目录

|`passwd username`
|给用户设定密码

|`groupadd groupname`
|创建一个 group

|`groupmod -n group group`
|修改组的名称

|`groupdel group`
|删除组

|`usermod -L user`
|锁定用户

|===

== 添加用户为 sudo 用户

[source, text]
----
# echo "kylin ALL=(ALL)       ALL" >> /etc/sudoers
# exit
$ sudo tail /var/log/secure
---- 

== 创建用户

[source, text]
----
# useradd juliet
# passwd juliet 
# useradd romeo
# passwd romeo
# useradd hamlet
# passwd hamlet
# useradd reba
# passwd reba
# useradd dolly
# passwd dolly
# useradd elvis
# passwd elvis
----

[source, text]
.*查看创建的用户*
----
# tail -6 /etc/passwd
juliet:x:1003:1003::/home/juliet:/bin/bash
romeo:x:1004:1004::/home/romeo:/bin/bash
hamlet:x:1005:1005::/home/hamlet:/bin/bash
reba:x:1006:1006::/home/reba:/bin/bash
dolly:x:1007:1007::/home/dolly:/bin/bash
elvis:x:1008:1008::/home/elvis:/bin/bash
----

== 创建组

[source, text]
----
# groupadd -g 30000 shakespeare
# groupadd artists
----

[source, text]
.*usermod -G 添加用户到组*
----
# usermod -G shakespeare juliet
# usermod -G shakespeare romeo
# usermod -G artists reba
# usermod -G artists dolly
# usermod -G artists elvis
----

[source, text]
.*查看创建的组*
----
# tail -2 /etc/group
shakespeare:x:30000:juliet,romeo
artists:x:30001:reba,dolly,elvis
----

== 登录密码管理

[source, text]
.*usermod -L 锁定用户*
----
$ sudo usermod -L romeo
----

[source, text]
.*usermod -U 解锁用户*
----
$ sudo usermod -U romeo
----

[source, text]
.*chage -M 设定登录密码过期时间*
----
$ sudo chage -m 30 -M 90 -W 7 -I 30 romeo
----

[source, text]
.*chage -l 查看用户登录设置信息*
----
$ sudo chage -l romeo
Last password change					: Feb 16, 2018
Password expires					: May 17, 2018
Password inactive					: Jun 16, 2018
Account expires						: never
Minimum number of days between password change		: 30
Maximum number of days between password change		: 90
Number of days of warning before password expires	: 7
----

[source, text]
.*chage -d 0 强制下次登录修改密码*
----
$ sudo chage -d 0 romeo
----

[source, text]
.*设定用户登录密码在未来某个时间点过期*
----
$ sudo chage -E 2018-08-02 romeo
----

== 使用 LDAP 和 Kerberos 完成登录认证

[source, text]
.*安装相关软件包*
----
# yum -y install sssd authconfig-gtk krb5-workstation
----

[source, text]
.*system-config-authentication 进行安全配置*
----
# system-config-authentication
----
