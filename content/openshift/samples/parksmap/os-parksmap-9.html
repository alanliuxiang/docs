
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>9. Adding MongoDB · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-donate/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../../../styles/website.css">
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="os-parksmap-10.html" />
    
    
    <link rel="prev" href="os-parksmap-8.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../../">
            
                <a href="../../../">
            
                    
                    INTRODUCTION
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../../linux/">
            
                <a href="../../../linux/">
            
                    
                    LINUX
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../../../linux/rhel/readme.html">
            
                <a href="../../../linux/rhel/readme.html">
            
                    
                    安装
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1" data-path="../../../linux/rhel/pre-install.html">
            
                <a href="../../../linux/rhel/pre-install.html">
            
                    
                    安装 DVD 制作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2" data-path="../../../linux/rhel/install-img-usb.html">
            
                <a href="../../../linux/rhel/install-img-usb.html">
            
                    
                    生成 USB 介质
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.3" data-path="../../../linux/rhel/install.html">
            
                <a href="../../../linux/rhel/install.html">
            
                    
                    安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.4" data-path="../../../linux/rhel/kvm.html">
            
                <a href="../../../linux/rhel/kvm.html">
            
                    
                    KVM
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../../../linux/basic/basic.html">
            
                <a href="../../../linux/basic/basic.html">
            
                    
                    基础
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.2.1" data-path="../../../linux/basic/local-remote-login.html">
            
                <a href="../../../linux/basic/local-remote-login.html">
            
                    
                    本地及远程登录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.2" data-path="../../../linux/basic/filesystem-overview.html">
            
                <a href="../../../linux/basic/filesystem-overview.html">
            
                    
                    文件系统导视
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.3" data-path="../../../linux/basic/user-group.html">
            
                <a href="../../../linux/basic/user-group.html">
            
                    
                    用户和组
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.4" data-path="../../../linux/basic/packages-update.html">
            
                <a href="../../../linux/basic/packages-update.html">
            
                    
                    软件包的安装与更新
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.5" data-path="../../../linux/basic/syslog.html">
            
                <a href="../../../linux/basic/syslog.html">
            
                    
                    系统日志
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.6" data-path="../../../linux/basic/ntp.html">
            
                <a href="../../../linux/basic/ntp.html">
            
                    
                    NTP
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../../../linux/networking/">
            
                <a href="../../../linux/networking/">
            
                    
                    网络
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.3.1" data-path="../../../linux/networking/ifcfg.html">
            
                <a href="../../../linux/networking/ifcfg.html">
            
                    
                    网络配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.2" data-path="../../../linux/networking/ipv6cfg.html">
            
                <a href="../../../linux/networking/ipv6cfg.html">
            
                    
                    IPv6 网络配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.3" data-path="../../../linux/networking/netns.html">
            
                <a href="../../../linux/networking/netns.html">
            
                    
                    namespace
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.4" data-path="../../../linux/networking/teaming.html">
            
                <a href="../../../linux/networking/teaming.html">
            
                    
                    teaming
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.5" data-path="../../../linux/networking/bridge.html">
            
                <a href="../../../linux/networking/bridge.html">
            
                    
                    bridge
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.6" data-path="../../../linux/networking/dns.html">
            
                <a href="../../../linux/networking/dns.html">
            
                    
                    DNS
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../../../linux/stoarges/readme.html">
            
                <a href="../../../linux/stoarges/readme.html">
            
                    
                    存储
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.4.1" data-path="../../../linux/stoarges/fs.html">
            
                <a href="../../../linux/stoarges/fs.html">
            
                    
                    文件系统
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.2" data-path="../../../linux/stoarges/lvm.html">
            
                <a href="../../../linux/stoarges/lvm.html">
            
                    
                    LVM
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.3" data-path="../../../linux/stoarges/nfs.html">
            
                <a href="../../../linux/stoarges/nfs.html">
            
                    
                    NFS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.4" data-path="../../../linux/stoarges/file-storage.html">
            
                <a href="../../../linux/stoarges/file-storage.html">
            
                    
                    文件存储
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.5" data-path="../../../linux/stoarges/block-storage.html">
            
                <a href="../../../linux/stoarges/block-storage.html">
            
                    
                    块存储
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../../../linux/security/">
            
                <a href="../../../linux/security/">
            
                    
                    安全
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.5.1" data-path="../../../linux/security/file-permissions.html">
            
                <a href="../../../linux/security/file-permissions.html">
            
                    
                    文件权限
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.2" data-path="../../../linux/security/SELinux.html">
            
                <a href="../../../linux/security/SELinux.html">
            
                    
                    SELinux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.3" data-path="../../../linux/security/selinux-contexts-permission-control.html">
            
                <a href="../../../linux/security/selinux-contexts-permission-control.html">
            
                    
                    Using SELinux Contexts to perform permission control
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.4" data-path="../../../linux/security/selinux-boolean-home.html">
            
                <a href="../../../linux/security/selinux-boolean-home.html">
            
                    
                    Appache to access user home directories
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../../../linux/process/">
            
                <a href="../../../linux/process/">
            
                    
                    进程
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.6.1" data-path="../../../linux/process/management.html">
            
                <a href="../../../linux/process/management.html">
            
                    
                    进程管理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6.2" data-path="../../../linux/process/service.html">
            
                <a href="../../../linux/process/service.html">
            
                    
                    服务管理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6.3" data-path="../../../linux/process/schedule.html">
            
                <a href="../../../linux/process/schedule.html">
            
                    
                    周期性运行进程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6.4" data-path="../../../linux/process/bash.html">
            
                <a href="../../../linux/process/bash.html">
            
                    
                    bash
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="../../../linux/svc/">
            
                <a href="../../../linux/svc/">
            
                    
                    常用服务
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.7.1" data-path="../../../linux/svc/openssh.html">
            
                <a href="../../../linux/svc/openssh.html">
            
                    
                    OpenSSH
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7.2" data-path="../../../linux/svc/postfix.html">
            
                <a href="../../../linux/svc/postfix.html">
            
                    
                    Email
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7.3" data-path="../../../linux/svc/mariadb.html">
            
                <a href="../../../linux/svc/mariadb.html">
            
                    
                    MariaDB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7.4" data-path="../../../linux/svc/httpd.html">
            
                <a href="../../../linux/svc/httpd.html">
            
                    
                    HTTPD
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../../../docker/docker.html">
            
                <a href="../../../docker/docker.html">
            
                    
                    DOCKER
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../../../docker/svc/svc.html">
            
                <a href="../../../docker/svc/svc.html">
            
                    
                    容器化服务
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="../../../docker/svc/mysql.html">
            
                <a href="../../../docker/svc/mysql.html">
            
                    
                    mysql
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="../../../docker/svc/httpd.html">
            
                <a href="../../../docker/svc/httpd.html">
            
                    
                    httpd
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../../../docker/container.html">
            
                <a href="../../../docker/container.html">
            
                    
                    容器管理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../../../docker/images.html">
            
                <a href="../../../docker/images.html">
            
                    
                    容器镜像
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../../openshift.html">
            
                <a href="../../openshift.html">
            
                    
                    OPENSHIFT
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../../concepts/">
            
                <a href="../../concepts/">
            
                    
                    概念
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../../install/">
            
                <a href="../../install/">
            
                    
                    安装
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.2.1" data-path="../../install/yum.html">
            
                <a href="../../install/yum.html">
            
                    
                    本地 yum 源配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.2" data-path="../../install/architecture.html">
            
                <a href="../../install/architecture.html">
            
                    
                    整体架构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.3" data-path="../../install/static-dns-ssh.html">
            
                <a href="../../install/static-dns-ssh.html">
            
                    
                    静态域名，SSH 互信
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.4" data-path="../../install/env-setup.html">
            
                <a href="../../install/env-setup.html">
            
                    
                    软件包安装及环境准备
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.5" data-path="../../install/dns-setup.adoc">
            
                <span>
            
                    
                    本地 DNS 服务器配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.6" data-path="../../install/docker-repo-setup.html">
            
                <a href="../../install/docker-repo-setup.html">
            
                    
                    公共镜像仓库配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.7" data-path="../../install/install.html">
            
                <a href="../../install/install.html">
            
                    
                    安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.8" data-path="../../install/post-install.html">
            
                <a href="../../install/post-install.html">
            
                    
                    后续配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.9" data-path="../../install/git-setup.html">
            
                <a href="../../install/git-setup.html">
            
                    
                    gitlab 配置
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../samples.html">
            
                <a href="../samples.html">
            
                    
                    示例
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.3.1" data-path="../deploy-image-to-docker-registry.html">
            
                <a href="../deploy-image-to-docker-registry.html">
            
                    
                    deploy image to docker registry
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.2" data-path="../elastic-spark.html">
            
                <a href="../elastic-spark.html">
            
                    
                    elasticsearch and spark
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.3" data-path="../deploy-mysql-db.html">
            
                <a href="../deploy-mysql-db.html">
            
                    
                    部署 mysql 数据库
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.4" data-path="../new-app-s2i.html">
            
                <a href="../new-app-s2i.html">
            
                    
                    通过 s2i 构建容器化的应用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.5" data-path="../wordpress/wp.html">
            
                <a href="../wordpress/wp.html">
            
                    
                    wordpress
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.6" data-path="../cicd.html">
            
                <a href="../cicd.html">
            
                    
                    CICD Pipeline
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.7" data-path="os-parksmap.html">
            
                <a href="os-parksmap.html">
            
                    
                    parksmap
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.3.7.1" data-path="os-parksmap-1.html">
            
                <a href="os-parksmap-1.html">
            
                    
                    1. Installing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.7.2" data-path="os-parksmap-2.html">
            
                <a href="os-parksmap-2.html">
            
                    
                    2. Exploring
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.7.3" data-path="os-parksmap-3.html">
            
                <a href="os-parksmap-3.html">
            
                    
                    3. Architecture Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.7.4" data-path="os-parksmap-4.html">
            
                <a href="os-parksmap-4.html">
            
                    
                    4. Deploying Docker Image
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.7.5" data-path="os-parksmap-5.html">
            
                <a href="os-parksmap-5.html">
            
                    
                    5. Scaling
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.7.6" data-path="os-parksmap-6.html">
            
                <a href="os-parksmap-6.html">
            
                    
                    6. Creating Routes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.7.7" data-path="os-parksmap-7.html">
            
                <a href="os-parksmap-7.html">
            
                    
                    7. Role-Based Access Control
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.7.8" data-path="os-parksmap-8.html">
            
                <a href="os-parksmap-8.html">
            
                    
                    8. Deploying Python
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.4.3.7.9" data-path="os-parksmap-9.html">
            
                <a href="os-parksmap-9.html">
            
                    
                    9. Adding MongoDB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.7.10" data-path="os-parksmap-10.html">
            
                <a href="os-parksmap-10.html">
            
                    
                    10. Application Health
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.7.11" data-path="os-parksmap-11.html">
            
                <a href="os-parksmap-11.html">
            
                    
                    11. CI/CD
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.7.12" data-path="../parksma/pos-parksmap-12.adoc">
            
                <span>
            
                    
                    12. Using Templates
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.3.8" data-path="../vdb-data-svc.html">
            
                <a href="../vdb-data-svc.html">
            
                    
                    Teiid Data Service
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../../devops.html">
            
                <a href="../../devops.html">
            
                    
                    DevOps
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../../100/">
            
                <a href="../../100/">
            
                    
                    PlaceHolder
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.5.1" data-path="../../100/001.html">
            
                <a href="../../100/001.html">
            
                    
                    Create an App from a Docker image
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.2" data-path="../../100/002.html">
            
                <a href="../../100/002.html">
            
                    
                    Create an App using Docker build
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.3" data-path="../../100/003.html">
            
                <a href="../../100/003.html">
            
                    
                    Using Web Console
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.4" data-path="../../100/004.html">
            
                <a href="../../100/004.html">
            
                    
                    Create an App using JBoss EAP builder image
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.5" data-path="../../100/005.html">
            
                <a href="../../100/005.html">
            
                    
                    Using Templates
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.6" data-path="../../100/006.html">
            
                <a href="../../100/006.html">
            
                    
                    Scale up/down and Idle the app
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.7" data-path="../../100/007.html">
            
                <a href="../../100/007.html">
            
                    
                    Binary Deployment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.8" data-path="../../100/008.html">
            
                <a href="../../100/008.html">
            
                    
                    Using SSL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.9" data-path="../../100/009.html">
            
                <a href="../../100/009.html">
            
                    
                    Horizontal Auto Scaling
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.10" data-path="../../100/010.html">
            
                <a href="../../100/010.html">
            
                    
                    Blue-Green Deployments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.11" data-path="../../100/011.html">
            
                <a href="../../100/011.html">
            
                    
                    SCM Web Hooks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.12" data-path="../../100/012.html">
            
                <a href="../../100/012.html">
            
                    
                    Rollback Applications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.13" data-path="../../100/013.html">
            
                <a href="../../100/013.html">
            
                    
                    Code Promotion across Environments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.14" data-path="../../100/014.html">
            
                <a href="../../100/014.html">
            
                    
                    JBoss Developer Studio
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.15" data-path="../../100/015.html">
            
                <a href="../../100/015.html">
            
                    
                    Deploy a SpringBoot Application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.16" data-path="../../100/016.html">
            
                <a href="../../100/016.html">
            
                    
                    DaemonSets
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.17" data-path="../../100/017.html">
            
                <a href="../../100/017.html">
            
                    
                    StatefulSets
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.18" data-path="../../100/018.html">
            
                <a href="../../100/018.html">
            
                    
                    Jobs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.19" data-path="../../100/019.html">
            
                <a href="../../100/019.html">
            
                    
                    ConfigMap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.20" data-path="../../100/020.html">
            
                <a href="../../100/020.html">
            
                    
                    Secrets
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.21" data-path="../../100/021.html">
            
                <a href="../../100/021.html">
            
                    
                    PersistentVolumes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.22" data-path="../../100/022.html">
            
                <a href="../../100/022.html">
            
                    
                    PersistentVolumeClaims
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.23" data-path="../../100/023.html">
            
                <a href="../../100/023.html">
            
                    
                    Migrating Applications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.24" data-path="../../100/024.html">
            
                <a href="../../100/024.html">
            
                    
                    Template Creation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.25" data-path="../../100/025.html">
            
                <a href="../../100/025.html">
            
                    
                    Deployment Strategies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.26" data-path="../../100/026.html">
            
                <a href="../../100/026.html">
            
                    
                    Port Forwarding
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.27" data-path="../../100/027.html">
            
                <a href="../../100/027.html">
            
                    
                    Exposing non HTTP Services
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.28" data-path="../../100/028.html">
            
                <a href="../../100/028.html">
            
                    
                    Persistent Volume Access Modes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.29" data-path="../../100/029.html">
            
                <a href="../../100/029.html">
            
                    
                    Pipelines Using Jenkins
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.30" data-path="../../100/030.html">
            
                <a href="../../100/030.html">
            
                    
                    Binary Input Builds
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.31" data-path="../../100/031.html">
            
                <a href="../../100/031.html">
            
                    
                    Docker Builds
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.32" data-path="../../100/032.html">
            
                <a href="../../100/032.html">
            
                    
                    Writing Your Own S2I builders
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.33" data-path="../../100/development.html">
            
                <a href="../../100/development.html">
            
                    
                    开发
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.5.33.1" data-path="../../100/040.html">
            
                <a href="../../100/040.html">
            
                    
                    Git 服务器配置
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../../../ansible/">
            
                <a href="../../../ansible/">
            
                    
                    ANSIBLE
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../../../jboss/readme.html">
            
                <a href="../../../jboss/readme.html">
            
                    
                    APPDEV
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../../../jboss/openwhisk.html">
            
                <a href="../../../jboss/openwhisk.html">
            
                    
                    OpenWhisk
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../../../jboss/rhdm/">
            
                <a href="../../../jboss/rhdm/">
            
                    
                    RHDM
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../../../jboss/datavirt/datavirt.html">
            
                <a href="../../../jboss/datavirt/datavirt.html">
            
                    
                    JDV
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.3.1" data-path="../../../jboss/datavirt/software-list.html">
            
                <a href="../../../jboss/datavirt/software-list.html">
            
                    
                    软件版本号对照表
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.2" data-path="../../../jboss/datavirt/changelog.html">
            
                <a href="../../../jboss/datavirt/changelog.html">
            
                    
                    修订记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.3" data-path="../../../jboss/datavirt/download.html">
            
                <a href="../../../jboss/datavirt/download.html">
            
                    
                    下载
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.4" data-path="../../../jboss/datavirt/install.html">
            
                <a href="../../../jboss/datavirt/install.html">
            
                    
                    安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.5" data-path="../../../jboss/datavirt/start.html">
            
                <a href="../../../jboss/datavirt/start.html">
            
                    
                    启动
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.6" data-path="../../../jboss/datavirt/deploy-vdbs.html">
            
                <a href="../../../jboss/datavirt/deploy-vdbs.html">
            
                    
                    部署测试 VDB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.7" data-path="../../../jboss/datavirt/meta.html">
            
                <a href="../../../jboss/datavirt/meta.html">
            
                    
                    元数据
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../../../jboss/amq/amq.html">
            
                <a href="../../../jboss/amq/amq.html">
            
                    
                    A-MQ
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.4.1" data-path="../../../jboss/amq/install.html">
            
                <a href="../../../jboss/amq/install.html">
            
                    
                    AMQ 6.3 安装测试
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../../../jboss/fuse/">
            
                <a href="../../../jboss/fuse/">
            
                    
                    Fuse
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.5.1" data-path="../../../jboss/fuse/fuse-install.html">
            
                <a href="../../../jboss/fuse/fuse-install.html">
            
                    
                    安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5.2" data-path="../../../jboss/fuse/fuse-online.html">
            
                <a href="../../../jboss/fuse/fuse-online.html">
            
                    
                    Fuse Online
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5.3" data-path="../../../jboss/fuse/fuse-all-in-one.html">
            
                <a href="../../../jboss/fuse/fuse-all-in-one.html">
            
                    
                    BRMS & JDV & Mariadb & REST & FTP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5.4" data-path="../../../jboss/fuse/camel-maximo-sap.html">
            
                <a href="../../../jboss/fuse/camel-maximo-sap.html">
            
                    
                    IBM Maximo SAP Integration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5.5" data-path="../../../jboss/fuse/getstart.html">
            
                <a href="../../../jboss/fuse/getstart.html">
            
                    
                    FIS Get Starts
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.5.5.1" data-path="../../../jboss/fuse/gs-fis-rest.html">
            
                <a href="../../../jboss/fuse/gs-fis-rest.html">
            
                    
                    REST
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5.5.2" data-path="../../../jboss/fuse/gs-data-transformation.html">
            
                <a href="../../../jboss/fuse/gs-data-transformation.html">
            
                    
                    Transformation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5.5.3" data-path="../../../jboss/fuse/gs-fis-soap2rest.html">
            
                <a href="../../../jboss/fuse/gs-fis-soap2rest.html">
            
                    
                    SOAP TO REST
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5.5.4" data-path="../../../jboss/fuse/sso-3scale.html">
            
                <a href="../../../jboss/fuse/sso-3scale.html">
            
                    
                    3Scale & SSO on OpenShift
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.5.6" data-path="../../../jboss/fuse/camel-cbr.html">
            
                <a href="../../../jboss/fuse/camel-cbr.html">
            
                    
                    Camel Content-Based Router
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5.7" data-path="../../../jboss/fuse/camel-eips.html">
            
                <a href="../../../jboss/fuse/camel-eips.html">
            
                    
                    Camel EIPs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5.8" data-path="../../../jboss/fuse/camel-errorhandler.html">
            
                <a href="../../../jboss/fuse/camel-errorhandler.html">
            
                    
                    Dead Letter Channel
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="../../../jboss/bpm/bpm.html">
            
                <a href="../../../jboss/bpm/bpm.html">
            
                    
                    BPM
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.6.1" data-path="../../../jboss/bpm/install.html">
            
                <a href="../../../jboss/bpm/install.html">
            
                    
                    安装测试
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../../../solutions/">
            
                <a href="../../../solutions/">
            
                    
                    SOLUTIONS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../../../solutions/jbds-jdv.html">
            
                <a href="../../../solutions/jbds-jdv.html">
            
                    
                    JBDS 创建虚拟数据库操作示例
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../../../solutions/ep-data-solution.html">
            
                <a href="../../../solutions/ep-data-solution.html">
            
                    
                    企业数据整合案例
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../../../solutions/spark-gs.html">
            
                <a href="../../../solutions/spark-gs.html">
            
                    
                    Spark Get Start
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../../.." >9. Adding MongoDB</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="adding-a-database-application-description">Adding a Database Application Description</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In this lab, we&#x2019;re going to deploy a Mongo database that will be used to store the data for the nationalparks application. We will also connect the nationalparks service with the newly deployed Mongo database, so that the nationalparks service can load and query the database for the corresponding information.</p>
</div>
<div class="paragraph">
<p>Finally, we will mark the nationalparks application as a backend for the map visualization tool, so that it can be dynamically discovered by the parksmap component using the OpenShift discovery mechanism and the map will be displayed automatically.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="img/roadshow-app-architecture-nationalparks-2.png" alt="roadshow-app-architecture-nationalparks-2"></span></p>
</div>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_background_storage">Background: Storage</a></li>
<li><a href="#_background_environment_variables">Background: Environment Variables</a></li>
<li><a href="#_exercise_wiring_the_application_and_the_database">Exercise: Wiring the Application and the Database</a></li>
<li><a href="#_exercise_exploring_openshift_magic">Exercise: Exploring OpenShift Magic</a></li>
<li><a href="#_exercise_data_data_everywhere">Exercise: Data, Data, Everywhere</a></li>
<li><a href="#_exercise_working_with_labels">Exercise: Working With Labels</a></li>
</ul>
</div>
</div>
<div class="sect1">
<h2 id="_background_storage">Background: Storage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Most useful applications are &quot;stateful&quot; or &quot;dynamic&quot; in some way, and this is usually achieved with a database or other data storage. In this next lab we are going to add MongoDB to our nationalparks application and then rewire it to talk to the database using environment variables.</p>
</div>
<div class="paragraph">
<p>We are going to use the MongoDB image that is included with OpenShift.</p>
</div>
<div class="paragraph">
<p>By default, this will use <code>EmptyDir</code> for data storage, which means if the <code>Pod</code> disappears the data does as well. In a real application you would use OpenShift&#x2019;s persistent storage mechanism to attach real-world storage (NFS, Gluster, EBS, etc) to the <code>Pods</code> to give them a persistent place to store their data.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_background_environment_variables">Background: Environment Variables</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As you&#x2019;ve seen so far, the web console makes it very easy to deploy things onto OpenShift. When we deploy the database, we pass in some environment variables. These environment variables are used to set the username, password, and name of the database. You can change the values of these environment variables to anything you would like. The variables we are going to be setting are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MONGODB_USER</p>
</li>
<li>
<p>MONGODB_PASSWORD</p>
</li>
<li>
<p>MONGODB_DATABASE</p>
</li>
<li>
<p>MONGODB_ADMIN_PASSWORD</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The database image is built in a way that it will automatically configure itself using the supplied information (assuming there is no data already present in the persistent storage!). The image will ensure that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A database exists with the specified name</p>
</li>
<li>
<p>A user exists with the specified name</p>
</li>
<li>
<p>The user can access the specified database with the specified password</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the web console in your project-userXY project, again click the &quot;Add to Project&quot; button, and then find the mongodb-ephemeral template, and click it. You will notice that there are several MongoDB templates available, some of which come with application servers pre-configured. We just need a database, though, so mongodb-ephemeral is what you should choose.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="img/ocp-mongodb-template.png" alt="ocp-mongodb-template"></span></p>
</div>
<div class="paragraph">
<p>When we performed the application build we selected the builder image to use and OpenShift presented us the standard build workflow. Now we are using a template, a preconfigured set of resources that includes parameters that can be customized. In our case, the parameters we are concerned with are the environment variables discussed before (user, password, database, and admin password).</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="img/ocp-mongo-template-deploy.png" alt="ocp-mongo-template-deploy"></span></p>
</div>
<div class="paragraph">
<p>You can see that some of the fields say &quot;generated if empty&quot;. This is a feature of Templates in OpenShift that will be covered in the next lab. For now, be sure to use the following values in their respective fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MONGODB_USER : mongodb</p>
</li>
<li>
<p>MONGODB_PASSWORD : mongodb</p>
</li>
<li>
<p>MONGODB_DATABASE: mongodb</p>
</li>
<li>
<p>MONGODB_ADMIN_PASSWORD : mongodb</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can leave the rest of the values as their defaults, and then click &quot;Create&quot;. Then click Continue to overview. The MongoDB instance should quickly be deployed.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="img/mongo-group-db-1.png" alt="mongo-group-db-1"></span></p>
</div>
<div class="paragraph">
<p>You can group services in OpenShift Console in order to display related services together in one panel. Click on the chain icon on the right-top corner of the nationalparks service, choose mongodb from the drop-down list in the Group Service to nationalparks dialog and click on OK. The nationalparks and mongodb services are groups and displayed together.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="img/mongo-group-db-2.png" alt="mongo-group-db-2"></span></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exercise_wiring_the_application_and_the_database">Exercise: Wiring the Application and the Database</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When we initially created the nationalparks application, we provided no environment variables. The application is looking for a database, but can&#x2019;t find one, and it fails gracefully (you don&#x2019;t see an error).</p>
</div>
<div class="paragraph">
<p>We need to configure the nationalparks <code>Pod</code>(s) to have the right values in the right environment variables so that the application knows how and where to find MongoDB.</p>
</div>
<div class="paragraph">
<p>If you think way back to the beginning of the labs, you will recall that a <code>DeploymentConfiguration</code> tells OpenShift how to deploy something. This includes things like what environment variables to configure. So, to set up the right environment variables, we simply need to modify the <code>DeploymentConfiguration</code> (DC). This can easily be done from either the web interface or via the command line.</p>
</div>
<div class="paragraph">
<p>The command line takes a little less time, so let&#x2019;s use that option. First, find the name of the DC:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc get dc
NAME            REVISION   DESIRED   CURRENT   TRIGGERED BY
mongodb         1          1         1         config,image(mongodb:3.2)
nationalparks   1          1         1         config,image(nationalparks:latest)
parksmap        2          1         1         config,image(parksmap:1.2.0)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, use the oc env command to set environment variables directly on the DC:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc env dc nationalparks <span class="hljs-_">-e</span> DB_USERNAME=mongodb <span class="hljs-_">-e</span> DB_PASSWORD=mongodb <span class="hljs-_">-e</span> DB_NAME=mongodb <span class="hljs-_">-e</span> DB_HOST=mongodb
deploymentconfig <span class="hljs-string">&quot;nationalparks&quot;</span> updated</code></pre>
</div>
</div>
<div class="paragraph">
<p>After you have modified the <code>DeploymentConfig</code> object, you can verify the environment variables have been added by viewing the YAML for it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc get dc nationalparks -o yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see the following section:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> DeploymentConfig
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  annotations:</span>
    openshift.io/generated-by: OpenShiftWebConsole
<span class="hljs-attr">  creationTimestamp:</span> <span class="hljs-number">2017</span><span class="hljs-bullet">-07</span><span class="hljs-bullet">-04</span>T09:<span class="hljs-number">41</span>:<span class="hljs-number">51</span>Z
<span class="hljs-attr">  generation:</span> <span class="hljs-number">4</span>
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    app:</span> nationalparks
<span class="hljs-attr">  name:</span> nationalparks
<span class="hljs-attr">  namespace:</span> project-ksoong
<span class="hljs-attr">  resourceVersion:</span> <span class="hljs-string">&quot;4074573&quot;</span>
<span class="hljs-attr">  selfLink:</span> /oapi/v1/namespaces/project-ksoong/deploymentconfigs/nationalparks
<span class="hljs-attr">  uid:</span> <span class="hljs-number">020</span>a0704<span class="hljs-bullet">-609</span>d<span class="hljs-bullet">-11e7</span>-bbc1<span class="hljs-bullet">-0682973451</span>aa
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  replicas:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">  selector:</span>
<span class="hljs-attr">    deploymentconfig:</span> nationalparks
<span class="hljs-attr">  strategy:</span>
<span class="hljs-attr">    activeDeadlineSeconds:</span> <span class="hljs-number">21600</span>
<span class="hljs-attr">    resources:</span> {}
<span class="hljs-attr">    rollingParams:</span>
<span class="hljs-attr">      intervalSeconds:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">      maxSurge:</span> <span class="hljs-number">25</span>%
<span class="hljs-attr">      maxUnavailable:</span> <span class="hljs-number">25</span>%
<span class="hljs-attr">      timeoutSeconds:</span> <span class="hljs-number">600</span>
<span class="hljs-attr">      updatePeriodSeconds:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">    type:</span> Rolling
<span class="hljs-attr">  template:</span>
<span class="hljs-attr">    metadata:</span>
<span class="hljs-attr">      creationTimestamp:</span> <span class="hljs-literal">null</span>
<span class="hljs-attr">      labels:</span>
<span class="hljs-attr">        app:</span> nationalparks
<span class="hljs-attr">        deploymentconfig:</span> nationalparks
<span class="hljs-attr">    spec:</span>
<span class="hljs-attr">      containers:</span>
<span class="hljs-attr">      - env:</span>
<span class="hljs-attr">        - name:</span> DB_USERNAME
<span class="hljs-attr">          value:</span> mongodb
<span class="hljs-attr">        - name:</span> DB_PASSWORD
<span class="hljs-attr">          value:</span> mongodb
<span class="hljs-attr">        - name:</span> DB_NAME
<span class="hljs-attr">          value:</span> mongodb
<span class="hljs-attr">        - name:</span> DB_HOST
<span class="hljs-attr">          value:</span> mongodb
<span class="hljs-attr">        image:</span> <span class="hljs-number">172.30</span><span class="hljs-number">.160</span><span class="hljs-number">.227</span>:<span class="hljs-number">5000</span>/project-ksoong/nationalparks@sha256:<span class="hljs-number">07375820</span>fba423add40b6e201a638a6b922e15c44194aff68d320598927c5b09
<span class="hljs-attr">        imagePullPolicy:</span> Always
<span class="hljs-attr">        name:</span> nationalparks
<span class="hljs-attr">        ports:</span>
<span class="hljs-attr">        - containerPort:</span> <span class="hljs-number">8080</span>
<span class="hljs-attr">          protocol:</span> TCP
<span class="hljs-attr">        resources:</span> {}
<span class="hljs-attr">        terminationMessagePath:</span> /dev/termination-log
<span class="hljs-attr">      dnsPolicy:</span> ClusterFirst
<span class="hljs-attr">      restartPolicy:</span> Always
<span class="hljs-attr">      securityContext:</span> {}
<span class="hljs-attr">      terminationGracePeriodSeconds:</span> <span class="hljs-number">30</span>
<span class="hljs-attr">  test:</span> <span class="hljs-literal">false</span>
<span class="hljs-attr">  triggers:</span>
<span class="hljs-attr">  - imageChangeParams:</span>
<span class="hljs-attr">      automatic:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">      containerNames:</span>
<span class="hljs-bullet">      -</span> nationalparks
<span class="hljs-attr">      from:</span>
<span class="hljs-attr">        kind:</span> ImageStreamTag
<span class="hljs-attr">        name:</span> nationalparks:latest
<span class="hljs-attr">        namespace:</span> project-ksoong
<span class="hljs-attr">      lastTriggeredImage:</span> <span class="hljs-number">172.30</span><span class="hljs-number">.160</span><span class="hljs-number">.227</span>:<span class="hljs-number">5000</span>/project-ksoong/nationalparks@sha256:<span class="hljs-number">07375820</span>fba423add40b6e201a638a6b922e15c44194aff68d320598927c5b09
<span class="hljs-attr">    type:</span> ImageChange
<span class="hljs-attr">  - type:</span> ConfigChange
<span class="hljs-attr">status:</span>
<span class="hljs-attr">  availableReplicas:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">  conditions:</span>
<span class="hljs-attr">  - lastTransitionTime:</span> <span class="hljs-number">2017</span><span class="hljs-bullet">-07</span><span class="hljs-bullet">-04</span>T09:<span class="hljs-number">42</span>:<span class="hljs-number">55</span>Z
<span class="hljs-attr">    lastUpdateTime:</span> <span class="hljs-number">2017</span><span class="hljs-bullet">-07</span><span class="hljs-bullet">-04</span>T09:<span class="hljs-number">42</span>:<span class="hljs-number">55</span>Z
<span class="hljs-attr">    message:</span> Deployment config has minimum availability.
<span class="hljs-attr">    status:</span> <span class="hljs-string">&quot;True&quot;</span>
<span class="hljs-attr">    type:</span> Available
<span class="hljs-attr">  - lastTransitionTime:</span> <span class="hljs-number">2017</span><span class="hljs-bullet">-07</span><span class="hljs-bullet">-04</span>T10:<span class="hljs-number">25</span>:<span class="hljs-number">21</span>Z
<span class="hljs-attr">    lastUpdateTime:</span> <span class="hljs-number">2017</span><span class="hljs-bullet">-07</span><span class="hljs-bullet">-04</span>T10:<span class="hljs-number">25</span>:<span class="hljs-number">23</span>Z
<span class="hljs-attr">    message:</span> replication controller <span class="hljs-string">&quot;nationalparks-2&quot;</span> successfully rolled out
<span class="hljs-attr">    reason:</span> NewReplicationControllerAvailable
<span class="hljs-attr">    status:</span> <span class="hljs-string">&quot;True&quot;</span>
<span class="hljs-attr">    type:</span> Progressing
<span class="hljs-attr">  details:</span>
<span class="hljs-attr">    causes:</span>
<span class="hljs-attr">    - type:</span> ConfigChange
<span class="hljs-attr">    message:</span> config change
<span class="hljs-attr">  latestVersion:</span> <span class="hljs-number">2</span>
<span class="hljs-attr">  observedGeneration:</span> <span class="hljs-number">4</span>
<span class="hljs-attr">  readyReplicas:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">  replicas:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">  unavailableReplicas:</span> <span class="hljs-number">0</span>
<span class="hljs-attr">  updatedReplicas:</span> <span class="hljs-number">1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also just ask OpenShift to tell you about the environment variables on the DC:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc env dc/nationalparks --list
<span class="hljs-comment"># deploymentconfigs nationalparks, container nationalparks</span>
DB_USERNAME=mongodb
DB_PASSWORD=mongodb
DB_NAME=mongodb
DB_HOST=mongodb</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exercise_exploring_openshift_magic">Exercise: Exploring OpenShift Magic</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As soon as we set the environment variables on the <code>DeploymentConfiguration</code>, some magic happened. OpenShift decided that this was a significant enough change to warrant updating the internal version number of the <code>DeploymentConfiguration</code>. You can verify this by looking at the output of oc get dc:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc get dc
NAME            REVISION   DESIRED   CURRENT   TRIGGERED BY
mongodb         1          1         1         config,image(mongodb:3.2)
nationalparks   2          1         1         config,image(nationalparks:latest)
parksmap        2          1         1         config,image(parksmap:1.2.0)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Something that increments the version of a <code>DeploymentConfiguration</code>, by default, causes a new deployment. You can verify this by looking at the output of oc get rc:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc get rc
NAME              DESIRED   CURRENT   READY     AGE
mongodb-1         1         1         1         11m
nationalparks-1   0         0         0         48m
nationalparks-2   1         1         1         6m
parksmap-1        0         0         0         4h
parksmap-2        1         1         1         1h</code></pre>
</div>
</div>
<div class="paragraph">
<p>We see that the desired and current number of instances for the &quot;-1&quot; deployment is 0. The desired and current number of instances for the &quot;-2&quot; deployment is 1. This means that OpenShift has gracefully torn down our &quot;old&quot; application and stood up a &quot;new&quot; instance.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exercise_data_data_everywhere">Exercise: Data, Data, Everywhere</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that we have a database deployed, we can again visit the nationalparks web service to query for data:</p>
</div>
<div class="paragraph">
<p><a href="http://nationalparks-parksmap.example.com.com/ws/data/all" class="bare" target="_blank">http://nationalparks-parksmap.example.com.com/ws/data/all</a></p>
</div>
<div class="paragraph">
<p>And the result?</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[]</pre>
</div>
</div>
<div class="paragraph">
<p>Where&#x2019;s the data? Think about the process you went through. You deployed the application and then deployed the database. Nothing actually loaded anything INTO the database, though.</p>
</div>
<div class="paragraph">
<p>The application provides an endpoint to do just that:</p>
</div>
<div class="paragraph">
<p><a href="http://nationalparks-parksmap.example.com.com/ws/data/load" class="bare" target="_blank">http://nationalparks-parksmap.example.com.com/ws/data/load</a></p>
</div>
<div class="paragraph">
<p>And the result?</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&quot;Inserted 2740 items.&quot;</pre>
</div>
</div>
<div class="paragraph">
<p>If you then go back to <code>/ws/data/all</code> you will see tons of JSON data now. That&#x2019;s great. Our parks map should finally work!</p>
</div>
<div class="paragraph">
<p>Hmm&#x2026;&#x200B; There&#x2019;s just one thing. The main map STILL isn&#x2019;t displaying the parks. That&#x2019;s because the front end parks map only tries to talk to services that have the right Label.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exercise_working_with_labels">Exercise: Working With Labels</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We explored how a <code>Label</code> is just a key=value pair earlier when looking at <code>Services</code> and <code>Routes</code> and <code>Selectors</code>. In general, a <code>Label</code> is simply an arbitrary key=value pair. It could be anything.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>pizza=pepperoni</p>
</li>
<li>
<p>wicked=googly</p>
</li>
<li>
<p>openshift=awesome</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the case of the parks map, the application is actually querying the OpenShift API and asking about the Routes in the project. If any of them have a Label that is <code>type=parksmap-backend</code>, the application knows to interrogate that service&#x2019;s endpoints to look for map data.</p>
</div>
<div class="paragraph">
<p>Fortunately, the command line provides a convenient way for us to manipulate labels. describe the nationalparks service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc describe route nationalparks
Name:			nationalparks
Namespace:		project-ksoong
Created:		About an hour ago
Labels:			app=nationalparks
Annotations:		openshift.io/generated-by=OpenShiftWebConsole
			openshift.io/host.generated=<span class="hljs-literal">true</span>
Requested Host:		nationalparks-project-ksoong.apps.na1.openshift.opentlc.com
			  exposed on router router about an hour ago
Path:			&lt;none&gt;
TLS Termination:	&lt;none&gt;
Insecure Policy:	&lt;none&gt;
Endpoint Port:		8080-tcp

Service:	nationalparks
Weight:		100 (100%)
Endpoints:	10.1.7.60:8080</code></pre>
</div>
</div>
<div class="paragraph">
<p>You see that it only has one label: <code>app=nationalparks</code>. Now, use oc label:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc label route nationalparks <span class="hljs-built_in">type</span>=parksmap-backend
route <span class="hljs-string">&quot;nationalparks&quot;</span> labeled</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you check your browser now:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="img/parksmap-new-parks.png" alt="parksmap-new-parks"></span></p>
</div>
<div class="paragraph">
<p>You&#x2019;ll notice that the parks suddenly are showing up. That&#x2019;s really cool!</p>
</div>
</div>
</div>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="os-parksmap-8.html" class="navigation navigation-prev " aria-label="Previous page: 8. Deploying Python">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="os-parksmap-10.html" class="navigation navigation-next " aria-label="Next page: 10. Application Health">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"9. Adding MongoDB","level":"1.4.3.7.9","depth":4,"next":{"title":"10. Application Health","level":"1.4.3.7.10","depth":4,"path":"openshift/samples/parksmap/os-parksmap-10.adoc","ref":"openshift/samples/parksmap/os-parksmap-10.adoc","articles":[]},"previous":{"title":"8. Deploying Python","level":"1.4.3.7.8","depth":4,"path":"openshift/samples/parksmap/os-parksmap-8.adoc","ref":"openshift/samples/parksmap/os-parksmap-8.adoc","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{"copyrightYear":"2018","copyrightHolder":"Kylin Soong"},"plugins":["collapsible-menu","donate","-sharing","sharing-plus","splitter","back-to-top-button","edit-link"],"pluginsConfig":{"tbfed-pagefooter":{"copyright":"Copyright &copy Kylin Soong 2018","modify_label":"该文件修订时间：","modify_format":"YYYY-MM-DD HH:mm:ss"},"collapsible-menu":{},"splitter":{},"search":{},"sharing-plus":{"qq":false,"all":["facebook","google","twitter","instapaper","linkedin","pocket","stumbleupon"],"douban":false,"facebook":true,"weibo":false,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":true,"messenger":false,"line":false,"vk":false,"pocket":true,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"donate":{"alipay":"/images/alipay.png","alipayText":"支付宝捐赠","button":"赞赏","title":"","wechat":"/images/wechat.png","wechatText":"微信捐赠"},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"back-to-top-button":{},"sharing":{"weibo":true,"linkedin":true,"google":true,"facebook":true,"all":["facebook","google","linkedin","weibo"]},"edit-link":{"label":"Edit This Page","base":"https://github.com/kylinsoong/docs/blob/gh-pages"},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css"}},"file":{"path":"openshift/samples/parksmap/os-parksmap-9.adoc","mtime":"2018-06-01T01:29:20.177Z","type":"asciidoc"},"gitbook":{"version":"3.2.3","time":"2018-06-06T09:16:36.632Z"},"basePath":"../../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../../gitbook/gitbook.js"></script>
    <script src="../../../gitbook/theme.js"></script>
    
        
        <script src="../../../gitbook/gitbook-plugin-collapsible-menu/plugin.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-donate/plugin.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-sharing-plus/buttons.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-edit-link/plugin.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

